package: util-linux

essential:
  - util-linux_copyright

slices:
  # Note: Not all executables are currently testable in CI. Such files
  # are commented as we do not yet know if they are stable.
  bins:
    essential:
      - util-linux_blk-dev
      - util-linux_file
      - util-linux_file-system
      - util-linux_generated
      - util-linux_ipc
      - util-linux_kernel
      - util-linux_login
      - util-linux_misc
      - util-linux_namespace
      - util-linux_pam-profiles
      - util-linux_proc
      - util-linux_setarch
      - util-linux_shell
      - util-linux_su-support
      - util-linux_text-dev
      - util-linux_timers

  # Contains the binaries which supports running commands with substitute user
  # and group IDs.
  su-support:
    essential:
      - libc6_libs
      - libcap-ng0_libs
      # Libraries from libpam-modules are required as the libpam-runtime
      # configs reference them.
      - libpam-modules_libs
      # su reads the configs in /etc/pam.d to authenticate the user.
      - libpam-runtime_config
      - libpam0g_libs
      - util-linux_pam-profiles
    contents:
      /usr/bin/su:
      /usr/sbin/runuser:

  mime:
    contents:
      /usr/lib/mime/packages/util-linux:

  pam-profiles:
    contents:
      /etc/pam.d/runuser:
      /etc/pam.d/runuser-l:
      /etc/pam.d/su:
      /etc/pam.d/su-l:

  services:
    essential:
      - util-linux_bins
    contents:
      /usr/lib/systemd/system/fstrim.service:
      /usr/lib/systemd/system/fstrim.timer:

  copyright:
    contents:
      /usr/share/doc/util-linux/copyright:

  blk-dev:
    essential:
      - libblkid1_libs
      - libc6_libs
      - libcap-ng0_libs
      - libmount1_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
      - libsmartcols1_libs
      - libudev1_libs
    contents:
      /usr/bin/addpart:
      /usr/bin/delpart:
      /usr/bin/lsblk:
      /usr/bin/partx:
      /usr/bin/resizepart:
      /usr/sbin/blkdiscard:
      /usr/sbin/blkid:
      /usr/sbin/blkzone:
      /usr/sbin/blockdev:
      /usr/sbin/zramctl:

  file:
    essential:
      - libblkid1_libs
      - libc6_libs
      - libmount1_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
      - libsmartcols1_libs
      - libtinfo6_libs
    contents:
      /usr/bin/fallocate:
      /usr/bin/flock:
      /usr/bin/hardlink:
      /usr/bin/lslocks:
      /usr/bin/more:
      /usr/bin/rename.ul:

  file-system:
    essential:
      - libblkid1_libs
      - libc6_libs
      - libcap-ng0_libs
      - libmount1_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
      - libsmartcols1_libs
      - libudev1_libs
      - libuuid1_libs
      - zlib1g_libs
    contents:
      /usr/bin/findmnt:
      /usr/bin/mountpoint:
      /usr/sbin/findfs:
      /usr/sbin/fsck:
      /usr/sbin/fsck.cramfs:
      /usr/sbin/fsck.minix:
      /usr/sbin/fsfreeze:
      /usr/sbin/fstrim:
      /usr/sbin/isosize:
      /usr/sbin/mkfs:
      /usr/sbin/mkfs.bfs:
      /usr/sbin/mkfs.cramfs:
      /usr/sbin/mkfs.minix:
      /usr/sbin/mkswap:
      /usr/sbin/swaplabel:
      /usr/sbin/switch_root:
      /usr/sbin/wipefs:

  # The following emulates the post-install script.
  generated:
    essential:
      # Since the more binary is located at ./usr/bin/more and /bin in noble
      # points to /usr/bin via base-files, the base-files_bin slice is included
      # here.
      - base-files_bin
      - util-linux_file
    contents:
      /usr/bin/pager: {symlink: /bin/more}

  setarch:
    essential:
      - libc6_libs
    contents:
      /usr/bin/i386: { arch: [i386, amd64] }
      /usr/bin/linux32:
      /usr/bin/linux64:
      /usr/bin/ppc: { arch: [ppc64el] }
      /usr/bin/ppc32: { arch: [ppc64el] }
      /usr/bin/ppc64: { arch: [ppc64el] }
      /usr/bin/s390: { arch: [s390x] }
      /usr/bin/s390x: { arch: [s390x] }
      /usr/bin/setarch:
      /usr/bin/x86_64: { arch: [amd64] }

  proc:
    essential:
      - libc6_libs
      - libcap-ng0_libs
      - libsmartcols1_libs
    contents:
      /usr/bin/choom:
      /usr/bin/chrt:
      /usr/bin/ionice:
      /usr/bin/prlimit:
      /usr/bin/setpriv:
      /usr/bin/setsid:
      /usr/bin/taskset:
      /usr/bin/uclampset:

  text-dev:
    essential:
      - libc6_libs
      - libtinfo6_libs
    contents:
      /usr/bin/setterm:
      /usr/sbin/agetty:
      /usr/sbin/getty:
      /usr/sbin/ldattach:

  namespace:
    essential:
      - libblkid1_libs
      - libc6_libs
      - libmount1_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
      - libsmartcols1_libs
    contents:
      /usr/bin/lsns:
      /usr/bin/nsenter:
      /usr/bin/unshare:

  kernel:
    essential:
      - libc6_libs
      - libtinfo6_libs
    contents:
      /usr/bin/dmesg:
      /usr/sbin/readprofile:

  login:
    essential:
      - libc6_libs
      - libcap-ng0_libs
      - libcrypt1_libs
      - libgcrypt20_libs
      - libgpg-error0_libs
      - liblz4-1_libs
      - liblzma5_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
      - libsmartcols1_libs
      - libsystemd0_libs
      - libzstd1_libs
    contents:
      /usr/bin/last:
      /usr/bin/lastb:
      /usr/bin/lslogins:
      /usr/bin/utmpdump:
      /usr/sbin/sulogin:

  timers:
    essential:
      - libc6_libs
      - libsmartcols1_libs
    contents:
      /usr/bin/wdctl:
      /usr/sbin/rtcwake:

  shell:
    essential:
      - libc6_libs
      - libpcre2-8-0_libs
      - libselinux1_libs
    contents:
      /usr/bin/getopt:
      /usr/bin/namei:
      /usr/bin/rev:
      /usr/bin/whereis:

  ipc:
    essential:
      - libc6_libs
      - libsmartcols1_libs
    contents:
      /usr/bin/ipcmk:
      /usr/bin/ipcrm:
      /usr/bin/ipcs:
      /usr/bin/lsipc:

  misc:
    essential:
      - libc6_libs
      - libsmartcols1_libs
    contents:
      /usr/bin/lscpu:
      /usr/bin/lsmem:
      /usr/bin/mcookie:
      /usr/bin/mesg:
      /usr/sbin/chcpu:
      /usr/sbin/chmem:
      /usr/sbin/ctrlaltdel:
      /usr/sbin/pivot_root:
